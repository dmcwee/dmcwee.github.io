<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
<!-- seo include -->
<meta name="description" content="" />
<link rel="canonical" href="http://localhost:4000/categories/Active%20Directory/" />
<meta property="article:published_time" content="" />
<script type="application/ld+json">
    {
        "@type":"Site",
        "url":"http://localhost:4000/categories/Active%20Directory/",
        "headline":"Category: Active Directory",
        "dateModified":"",
        "datePublished":"",
        "author":{
            "name":"David McWee",
            "@type":"Person",
            "url":"http://localhost:4000"
        },
        
        "image":"http://localhost:4000/assets/images/me.jpg",
        
        "mainEntityOfPage":{
            "@type":"WebPage",
            "@id":"http://localhost:4000",
            "url":"http://localhost:4000/categories/Active%20Directory/"
        },
        "description":"",
        "@context":"https://schema.org"
    }
</script>

<!-- facebook seo -->
<meta property="og:title" content="Category: Active Directory" />
<meta property="og:locale" content="en_US" />
<meta property="og:description" content="" />
<meta property="og:url" content="http://localhost:4000/categories/Active%20Directory/" />
<meta property="og:site_name" content="David McWee" />
<meta property="og:type" content="article" />
<!-- end facebook seo -->

<!-- twitter seo -->
<meta name="twitter:site" content="@" />
<meta name="twitter:title" content="Category: Active Directory" />
<meta name="twitter:description" content="" />


<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="http://localhost:4000/assets/images/me.jpg" />


<meta name="twitter:image:alt" content="David McWee's Site Image" />

<!-- end twitter seo -->

<!-- end seo include -->

<!-- startgoogle analytics --><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-K5M43KBSNX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-K5M43KBSNX');
</script><!-- end google analytics-->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <!--<link rel="stylesheet" href="/assets/css/blog.css">-->
    <link rel="stylesheet" href="/assets/css/davidmcwee.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="David McWee" />
    <title>David McWee - Category: Active Directory</title>
    
</head><body><div class="container">
    <header class="blog-header py-3 px-3">
        <div class="row flex-nowrap justify-content-between align-items-center">
            <div class="col-4 pt-1">
                <a class="link-secondary" href="/tenant-tracker">Tenant Tracker</a>
            </div>
            <div class="col-4 text-center">
                <a class="blog-header-logo" href="/">David McWee</a>
            </div>
            <div class="col-4 d-flex justify-content-end align-items-center">
                <a class="link-secondary" href="/about">About</a>
            </div>
        </div>
    </header>
    <div class="nav-scroller py-1 px-3 mb-2 nav-secondary">
        <nav class="nav d-flex justify-content-between">
            
            <a class="p-2 link-secondary" href="/categories/identity">Identity</a>
            
            <a class="p-2 link-secondary" href="/categories/security">Security</a>
            
            <a class="p-2 link-secondary" href="/categories/mde">Defender for Endpoint</a>
            
            <a class="p-2 link-secondary" href="/categories/mdi">Defender for Identity</a>
            
            <a class="p-2 link-secondary" href="/categories/mdo">Defender for Office</a>
            
        </nav>
    </div>
</div><main class="container">
      <article class="post">

  <header class="post-header">
    <h1 class="post-title">Category: Active Directory</h1>
  </header>

  <div class="post-content">
    
<article class="blog-post my-3">
    <h3>DirectoryEntry Exception when calling  Invoke("SetPassword",…)</h3>
    <p class="by-line">
        <span class="blog-date">Mon, Jul 21, 08</span>
        
        | <a href="/categories/Active Directory">Active Directory</a>
        
    </p>
    <p><p>I wrote a <a href="http://blogs.microlinkllc.com/dmcwee/archive/2008/05/13/ad-com-exception-in-windows-2003-server.aspx">blog</a> a few months ago about a COMException I got when I attempted to call DirectoryEntry.Invoke(“SetPassword”, …). The issue was that I could set the password for one account but then subsequent set password attempts would throw an exception. I had contacted Microsoft and they informed me that I was only the second person ever to report the problem, and that is was intermittent at best for the previous report. Microsoft had, and to this day still does not, have a hotfix for this issue.<br />
After testing and trying a lot of ideas I thought I had resolved the issue by just capturing the exception and continuing on in my code (later calls would set account enabled and commit, etc). However, when we deployed the solution we quickly realized our test environment was able to create the account more regularly than our production environment. Therefore our testers were able to create account with valid password and log into the test environment, but production users were getting invalid passwords.<br />
I started looking back through our system and SharePoint logs and realized I was still having the COMException get thrown and that the password change was not getting committed later in the process, our lost password utility really triggered this since both the account provisioner and lost password used the same logic for setting the password. Microsoft had told me that when the first caller notified them of this issue they were able to reset IIS and the issue was resolved.<br />
Although this is a high availability environment, we really couldn’t afford resetting our IIS on the server every time a new account was created. Instead I realized that I could push the DirectoryEntry.Invoke(“SetPassword”, …) into a web service and allow my provisioning code to use that. Each time a web service was called it essentially created a new process to handle the service request, and when complete the process would effectively terminate.<br />
Just to make sure this issue could also be worked around I added a Application Pool Recycle, basically a restart of an IIS Web Application, so that if it did fail we could restart the web service’s web application. I have been monitoring the log for about a month and have NEVER seen the recycle request. To date the code has created over 200 new Active Directory, MOSS, Exchange, and OCS accounts on our system.</p>

</p>
    <p><a class="link-secondary" href="/2008/07/21/directoryentry-exception-when-calling-invokesetpassword%e2%80%a6/">Read more...</a></p>
</article>

  </div>

</article>

    </main><script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>  
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script></body>
</html>